<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>yysaki blog - Archive (articles 1 to 5)</title>
    <link rel="stylesheet" href="/css/app.css"/>
    <link rel="stylesheet" href="/css/prism.css"/>
    <link rel="alternate" type="application/atom+xml" href="/atom" title="yysaki blog">
    <script src="/js/modernizr.js"></script>
    <script src="/js/prism.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-48038483-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <header class="interior-header green">
      <div class="row">
        <div class="medium-12 medium-centered centered-text columns">
          <h1>
            <a class="centered-text light" href="/">yysaki blog</a>
          </h1>
          <nav>
            <ul class="subnav hide-for-small">
              <li><a href="/">Home</a></li>
              <li class="with-input">
                <form action="https://google.com/search" method="get">
                  <input type="hidden" name="cx" value="004581985367838202738:guvugwiuerc"/>
                  <input class="input-text" type="text" name="q" placeholder="Search"/>
                </form>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <div class="row">
      <div class="large-8 medium-7 columns">
        <main role="main">
        

  <h1>Terraform RegistryのModuleを使ってHasuraを立てる</h1>
  <p>Terraformの素振りのため、公開されているModuleを使ってAWS ECSクラスター上にHasuraを立ててみました.<br />
Auth0での認証認可まで疎通確認できたので手順を共有します.</p>

<h2 id="概要">概要</h2>

<p><a href="https://hasura.io/">Hasura</a> について軽く説明をすると, これはPostgreSQLをバックエンドとしてAPIを自動生成してくれるGraphQLサーバーです. DBスキーマからとりうるCRUD操作をAPI越しに一通り行うことができるようにしてくれます. また、ロールベースの権限付与の仕組みをサポートしており、 <a href="https://auth0.com/jp/">Auth0</a> といったOAuthサービスプロバイダーと組み合わせることで、Hasura外部のサービスで認証を行ったユーザの認可から, ロールに許されたAPI操作を割り振ることができます。<br />
Hasuraのサービスを稼働させるためにはHerokuが推奨されていますが、あえてAWSで立てようとするなら <a href="https://hub.docker.com/r/hasura/graphql-engine">docker hubに提供されているDockerイメージ</a> とデータストアであるPostgreSQLを構築する必要から、ECSを使うのが自然な選択肢になるかと思います. ちょうどTerraformでAWSの環境構築をする練習りをしたかったこともあり <a href="https://hasura.io/">Hasura</a>を立てるのがお題として手頃そうでした.<br />
一方、Terraform Registryを”hasura”で検索してみると3件ほどマッチしました。 このうちメンテナンスされておりdownload数の多い <a href="https://registry.terraform.io/modules/Rayraegah/hasura/aws/3.0.2">Rayraegah/hasura/aws</a> があります.  ライセンスのところに <a href="https://github.com/elgordino">Gordon Johnston</a> により提案されたAWSアーキテクチャを採用しているとあります, おそらく以下の記事のことと見られます.</p>

<p><a href="https://dev.to/lineup-ninja/deploying-hasura-on-aws-with-fargate-rds-and-terraform-4gk7">Deploying Hasura on AWS with Fargate, RDS and Terraform - DEV</a></p>

<p>今回はこちらをお借りしてTerraformを素振りさせてもらいました.</p>

<h2 id="事前準備">事前準備</h2>

<p>今回の手順を行うにあたって必要な準備は以下の通りです:</p>

<ul>
  <li>Terraform 0.12 の実行環境</li>
  <li>AWSアカウント
    <ul>
      <li>IAMユーザ</li>
      <li>Route53で管理されているドメイン</li>
    </ul>
  </li>
  <li>Auth0アカウント</li>
  <li><a href="https://www.electronjs.org/apps/graphiql">GraphiQL.app</a> の実行環境
    <ul>
      <li>macos Homebrewであれば <code>brew cask install graphiql</code> しておく</li>
    </ul>
  </li>
</ul>

<p>この記事ではそれぞれのセットアップについては述べません.</p>

<h2 id="auth0の設定">Auth0の設定</h2>

<p>まず, Auth0について <a href="https://hasura.io/docs/1.0/graphql/manual/guides/integrations/auth0-jwt.html">Hasuraの公式ドキュメント</a> を参考に事前にSingle Page Applicationを用意しておきます. Hasuraの認証認可の仕組みをこちらで整えることになります.  手順の通りなのですが, ハマりどころとして2点補足しておきます.</p>

<p>一つ目はRulesです. “Configure Auth0 Rules &amp; Callback URLs”の手順にてJWTカスタムクレームを埋め込むためのスニペットが2通り記載されています. 厳密にはどちらでも構いませんが, この手順では前者のauth0.js向けのスニペットを入力してください. 2つ目は <a href="https://auth0.com/docs/api-auth/tutorials/adoption/oidc-conformant">OIDC Conformantを無効にする</a> ということです. “Test auth0 login and generate sample JWTs for testing” の手順でid_tokenを取得しますが, これを無効にしておかないとコールバック時にエラーとなります.</p>

<h2 id="terraformのapply">TerraformのApply</h2>

<p>手元の実行環境のお好きなディレクトリ配下に, Terraformのapplyのためmoduleの呼び出しを行う <code>main.tf</code> および変数定義を行う <code>terraform.tfvars</code> を用意しました.<br />
<a href="https://gist.github.com/yysaki/ad8396547b9fc1f14865d1b554bd24b7">gist</a>に貼ってありますが、それぞれ以下の通りです:</p>

<p>まず, main.tf:</p>

<div class="language-terraform highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>variable &quot;domain&quot; {}
variable &quot;hasura_admin_secret&quot; {}
variable &quot;rds_password&quot; {}
variable &quot;hasura_jwt_secret_key&quot; {}

module &quot;hasura&quot; {
  source                         = &quot;Rayraegah/hasura/aws&quot;
  version                        = &quot;3.0.2&quot;
  domain                         = var.domain
  hasura_version_tag             = &quot;v1.2.1&quot;
  hasura_admin_secret            = var.hasura_admin_secret
  hasura_jwt_secret_key          = var.hasura_jwt_secret_key
  hasura_jwt_secret_algo         = &quot;RS256&quot;
  rds_db_name                    = &quot;hasura&quot;
  rds_instance                   = &quot;db.t3.small&quot;
  rds_username                   = &quot;hasura&quot;
  rds_password                   = var.rds_password
  create_iam_service_linked_role = false
}

provider &quot;aws&quot; {
  region = &quot;ap-northeast-1&quot;
}
</pre></div>
</div>
</div>

<p>module “hasura”になるべくdefault値を使ったうえで必要な変数定義をしています. 秘密情報にしたかったものはvariableに切り出してtfvarsにて記述することにしました. defaultを上書きした変数は3箇所あります. 1つ目は <code>hasura_version_tag</code> , これは単純に執筆時点の最新版を使いたかったためです. 2つ目は <code>hasura_jwt_secret_algo</code> , こちらにはHS256 または RS256が選べますが, Auth0で使用するのは後者のため設定しました. 最後にcreate_iam_service_linked_role, これはAWSのアカウント上で初めてECSを作成したときに勝手に作られる <a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/using-service-linked-roles.html">service_linked_role</a> の有無についてです. 私の環境では以前にECSクラスターを作ったことがあるためfalseにしましたが, この操作が初めての場合defaultのtrueとしておきましょう.</p>

<p>次に, terraform.tfvars:</p>

<div class="language-txt highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>domain                = &quot;example.com&quot;
hasura_admin_secret   = &quot;Password&quot;
rds_password          = &quot;Password&quot;
hasura_jwt_secret_key = &lt;&lt;EOF
-----BEGIN CERTIFICATE-----
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxx
-----END CERTIFICATE-----
EOF
</pre></div>
</div>
</div>

<p>これにはvariableで定義した変数を指定しています. 1つ目の <code>domain</code> にはRoute53で管理しているdomainを指定してください. 続く <code>hasura_admin_secret</code> <code>rds_password</code> には, 前者はHasura管理画面の、 後者はRDSのパスワードになります. 最後の <code>hasura_jwt_secret_key</code> には先のAuth0の設定後に得られる公開鍵情報を入力します. <code>https://&lt;your-auth0-domain&gt;.auth0.com/pem</code> にアクセスすることで取得できます.</p>

<p>以上で設定が完了です. 作業したディレクトリ上で <code>terraform init</code>, <code>terraform plan</code>, <code>terraform apply</code> を実行しましょう.</p>

<h2 id="hasuraコンソールにログインする">Hasuraコンソールにログインする</h2>

<p>上記が無事成功したことを確認するために, ブラウザから <code>https://hasura.&lt;あなたのdomain&gt;</code> にアクセスしましょう. Hasuraのパスワード入力画面が出ますので, <code>hasura_admin_secret</code> を入力してください. <br />
Hasuraの管理画面が開くはずです.</p>

<p>Hasuraのコンソール画面から, テーブル定義およびそれのuserへのpermissionをしたとします. コンソール上でポチポチ操作するだけでOKで, これによりDBマイグレーションなどのメタデータ設定が簡単に行えます. 私の環境では <code>users</code> と <code>posts</code> テーブルを一対多の関係で定義、<code>user</code> ロールにそれぞれのテーブルへのSELECT権限の付与を行いました.</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">hasuraが立ったので雑なテーブル定義 <a href="https://t.co/jiOcOHCasZ">pic.twitter.com/jiOcOHCasZ</a></p>&mdash; sasaki (@yysaki) <a href="https://twitter.com/yysaki/status/1264112622816735232?ref_src=twsrc%5Etfw">May 23, 2020</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="graphql-apiの操作">GraphQL APIの操作</h2>

<p>これまでの設定がうまくいったことを確認するために, GraphQL APIを触ってみたいと思います. 手順としてはGraphiQL.app を起動します. アプリが起動したら <code>GraphQL Endpoint</code>に <code>https://hasura.&lt;あなたのdomain&gt;/v1/graphql</code> を入力します. 次に <code>Edit HTTP Headers</code> をクリックし, <code>Add Header</code> からHeader nameに<code>Authorization</code>, Header valueに <code>Bearer &lt;id_token&gt;</code> を入力します. このid_tokenは “Test auth0 login and generate sample JWTs for testing”で取得したものになります. これでトップ画面に戻るとうまくいった場合Document Explorer &gt; ROOT TYPES に利用可能なqueryがリストアップされます. これでHasuraから認証認可を踏まえたGraphQLのndpointが得られました.</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">Auth0認可も通ったのでOK <a href="https://t.co/6TaN17mIqU">pic.twitter.com/6TaN17mIqU</a></p>&mdash; sasaki (@yysaki) <a href="https://twitter.com/yysaki/status/1264122926783066112?ref_src=twsrc%5Etfw">May 23, 2020</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="後始末">後始末</h2>

<p>満足できるまで確認ができたら, 課金対象ですので AWSリソース を削除しましょう.  ただし, 安全のためaws_db_instanceのlife_cycleが <code>prevent_destroy = true</code> となっているため, 単に<code>terraform destroy</code> をしても成功しません. workaroundとして, main.tf 中のmodule定義をすべてコメントアウトして <code>terraform apply</code> を行ってから <code>terraform destroy</code> をすることでリソースの削除に成功します.</p>

<h2 id="まとめ">まとめ</h2>

<p>以上で, terraformのmoduleを使わせてもらったAWSでのhasuraの構築の素振りを行いました. 素振りをやろうとした当初はイチからtfファイルを書く気持ちでいたのですが, 先人の肩を借りて手数少なく実施することができました. まじまじとregistryに公開されているmoduleを読むのは初めてでしたが, ためになります.</p>


  <h1>Reactのチュートリアルで三目並べ</h1>
  <p>Reactのチュートリアルにある、三目並べを書いて動かしてみました.<br />
しばらくこっちのブログを書いていなかったので、準備運動てきにブログを更新します.</p>

<!-- more -->

<h3 id="やったこと">やったこと</h3>

<p>Reactの公式ドキュメントにある<a href="https://ja.reactjs.org/tutorial/tutorial.html">チュートリアル：React の導入 – React</a> に従い、三目並べ(tic-tac-toe)を書いてみました.<br />
動作例は以下の通り:</p>

<p class="codepen" data-height="300" data-theme-id="light" data-default-tab="js,result" data-user="yysaki" data-slug-hash="WNQEbGg" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="react-tic-tac-toe">
  <span>See the Pen <a href="https://codepen.io/yysaki/pen/WNQEbGg">
  react-tic-tac-toe</a> by yysaki (<a href="https://codepen.io/yysaki">@yysaki</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async="" src="https://static.codepen.io/assets/embed/ei.js"></script>

<h3 id="感想">感想</h3>

<p>感想としては、素朴なreactの構造を動かしながらpropsやコンポーネントの概念が把握できました.<br />
公式ドキュメントが日本語訳されており、とてもとっつきやすく感じました.</p>

<p>また, https://github.com/yysaki/react-tic-tac-toe リポジトリを作ってこの上で一通り作業していました.<br />
これはこれで create-react-app を使って <code>npm run start</code> できる状態を作る経験になったのですが、<br />
作業内容自体js 1ファイルのsnippetにに収まること, 動くサンプルをblogにかんたんに貼れると気づいたことから、<br />
codepenに途中から移行しました.<br />
手を動かして実験してみたいがリポジトリを作るほどでもないなーというものに対して使っていきたいと思います.</p>


  <h1>技術書典6に参加した</h1>
  <p>本日行われた <a href="https://techbookfest.org/event/tbf06">技術書典6</a> に行ってきました。<br />
初めての会場参加です。</p>

<!-- more -->

<h2 id="戦利品">戦利品</h2>

<p>戦利品は以下の通りです。</p>

<ul>
  <li>サークル名: <a href="http://testerchan.hatenadiary.com/">テスターちゃん</a>
    <ul>
      <li>テスターちゃん 1巻</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://blog.nkzn.info/entry/2019/04/09/011249">越後屋</a>
    <ul>
      <li>これでカンタン！ ITエンジニアが実践するキャッシュレス時代の資産管理</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://note.mu/gami/n/nffef53da2171">MERY Engineer Team</a>
    <ul>
      <li>スターティングgRPC</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://www.lambdanote.com/">ラムダノート株式会社</a>
    <ul>
      <li>n月刊ラムダノート Vol.1, No.1(2019)</li>
      <li>みんなのデータ構造</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://taimen.jp/shops/show/315">妄想実行部隊</a>
    <ul>
      <li>妄想実行報告書</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://shiganai.org/ep/ep34">しがないラジオ</a>
    <ul>
      <li>#チーム開発1年目の教科書</li>
      <li>#非エンジニアのためのJavaScript</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://twitter.com/takepepe/status/1116694363004751872">潜推艦</a>
    <ul>
      <li>ConditionalTypes I/O - TypeScript3.4 型の強化書 -</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://watanabeyu.blogspot.com/2019/04/6.html">ハムカツおじさん🤘</a>
    <ul>
      <li>#1人チーム本 ノウハウなしでも1人でなんとかなる React Native Expoを使ったアプリの開発環境構築/ビルド/デプロイ/運用</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://twitter.com/nabettu/status/1116989059715350530">ザ・シメサバズ</a>
    <ul>
      <li><a href="https://twitter.com/_hyme_/status/1116992952532779008">PWA Web サイトを Google Play Storeに公開するハンズオン</a></li>
      <li><a href="https://crieit.net/posts/indie-coder-jp">個人開発がやりたくなる本</a></li>
    </ul>
  </li>
  <li>サークル名: <a href="https://www.m3tech.blog/entry/m3techbook-01">エムスリーエンジニアリンググループ執筆部</a>
    <ul>
      <li>エムスリーテックブック#1</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://ota42y.com/blog/2019/04/13/techbook_6/">すべてがM(icro)になる</a>
    <ul>
      <li>Microservices architecture よろず本 その三</li>
      <li>Microservices architecture よろず本 その一＆その二</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://developers.cyberagent.co.jp/blog/archives/21439/">Japan Container Days</a>
    <ul>
      <li>showKsではじめるクラウドネイティブ開発</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://note.mu/okash1n/n/nfb10ad57a1f2">おからぼ</a>
    <ul>
      <li>ゼロトラスト超入門</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://www.chirashiura.com/entry/2019/03/24/235804">楽描帳</a>
    <ul>
      <li>コンテナ時代のWebサービスの作り方</li>
      <li>Pragmatic Terraform on AWS</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://www.authya.com/">Auth屋</a>
    <ul>
      <li>雰囲気でOAuth2.0を使っているエンジニアがOAuth2.0を整理して理解できる本</li>
    </ul>
  </li>
  <li>サークル名: <a href="https://blog.mtb-production.info/entry/2019/04/03/215501">足跡出版</a>
    <ul>
      <li>IT実務のアンチパターン コミュニケーション編</li>
    </ul>
  </li>
</ul>

<h2 id="感想">感想</h2>

<p>一般参加者入場を11:00~13:00の場合のみ有料にすることで、運営による入場者数の調整が図られています。<br />
初めは無料の入場期間に入ることをもくろんでいましたが、過去の入場待機列の様子に恐れをなして12:30ごろ会場入りしました。<br />
ちょうど待機列が履けたころのようで待機列に並ぶことなく入場券を購入できました。<br />
現地入りしてみると先行している入場者の密度が高く、人混み慣れしていない身には熱い熱気を感じました。</p>

<p>本は趣味分野のクラウドのサーバサイドからフロントエンドまでで、主に開発についてのものを購入しました。<br />
戦利品リストを見返すと半分くらいは予定してなかったもので、同人誌即売会の購買意欲のそそり立て具合に感じ入っています。<br />
目的としていた楽描帳さんの「コンテナ時代の個人Webサービスの作り方」、および「Pragmatic Terraform on AWS」だけは残念ながら紙の書籍は売り切れでしたが、それ以外は紙の書籍+DLCで入手できました。<br />
売れ筋のものをどうしても紙で欲しいという場合には、開場時間に並ぶ必要がありそうです。</p>

<p>今日は目的としていたサークルさんに顔を出すことが、それ以外にも知人がブースで売り子をしていて久しぶりに話ができたのが嬉しかったので満足しました。<br />
今回もまた積読の山をしこたま増やしたので、ガンガン読むぞーという意気込みです。</p>


  <h1>昨年の振り返りと新年の抱負</h1>
  <p>明けましておめでとうございます。<br />
早いもので2018年があっという間に一年が過ぎていきました。<br />
せっかくの節目の時ですので、備忘のために昨年の振り返りと新年の抱負を書いていきたいと思います。</p>

<!-- more -->

<h2 id="読書について">読書について</h2>

<p>今年は読書ペースが例年より上がりました。<br />
booklogから取れた読書記録のグラフを貼ってみます。</p>

<p><img src="/images/reading_2018.png" alt="今年一年のグラフ" width="50%" /></p>

<p>年内に100冊読むのがちょっとした目標だったのですが達成ならずです。<br />
なお、漫画、ライトノベルはカウントすると件数が乱高下するので記録しない習慣でいます。</p>

<p>趣味の読書としては一般小説やSF、ノンフィクションものが多く、勉強を兼ねた読書では７月はIT技術書がメインに読んでいました。<br />
前者で読んでよかったものを３つ挙げると「アンドロイドの夢の羊」、「五色の虹」、「わたしを離さないで」。<br />
後者では「レガシーコード改善ガイド」、「アジャイルな見積もりと計画づくり」、「エンジニアのためのマネジメントキャリアパス」がためになりました。</p>

<h2 id="趣味プロジェクトのこと">趣味プロジェクトのこと</h2>

<p>業務の外で味のプログラミングをしておりますが、どんな腹積もりでやっているかを書いてみます。<br />
自分のソフトウェアエンジニアとしてのスキルはどのようなものかを振り返ってみると、抜け穂が多いなーと感じました。<br />
SIerのエンジニア職でC#・PHPを触っており、職種としてはサーバーサイドからWEBフロントエンジニアの中間あたりにいるはずです。<br />
だけど、だからといってあまり体型だったスキルを持っているとは言えないんじゃないかと思っています。</p>

<ul>
  <li>一から運用サーバの構築をした経験が乏しい
    <ul>
      <li>社内Redmine/gitoliteサーバのリプレイスで構築しなおすみたいなことはしたけど、売上の発生する本業ではない</li>
    </ul>
  </li>
  <li>複雑なSQLのDML文をゴリゴリ書くのは好きだけどforeign key制約のあるデータベースを扱ったことがない
    <ul>
      <li>業務は回せても汎用的なスキルとしては育っていないんじゃ？</li>
    </ul>
  </li>
  <li>一通り作れるといってもデザインから画面イメージを1から起こせる自信がない
    <ul>
      <li>html/cssあたりにノウハウが足りない</li>
    </ul>
  </li>
</ul>

<p>この辺を自分の弱点だと感じていたので、趣味プロジェクトでいろいろやっていました。<br />
自分の方向性、趣味としては、ビジネスロジックを考えたりユニットテストを作りこむのは好きだがサーバーの面倒はなるべく見たくない。<br />
ユーザの体験に直結するUI/UXは作ってみたいが、iOS/androidのネイティブ開発にwebで汎用的にフロントエンドを作るほうが時間投資の優先度が高い。<br />
突き詰めると自分が向いてる・実際にやりたいのは職種でいうとサーバーサイドよりのwebフロントエンドなのかなあと考えました。<br />
そのようなことをつらつら考えつつ以下のようなことをやってきました。</p>

<ul>
  <li>Vue.js/Firebaseを使ってマークダウンアプリを作った</li>
</ul>

<p>以前ブログ投稿したのですが、これはwebフロントエンドの流行を追いかけてみたいモチベーションでやってみました。</p>

<p>記事: <a href="https://www.yysaki.com/blog/2018/09/30/vue-firebase-tutorial/">yysaki blog - #Webサービスを作る本 を読んで簡易markdownエディタを作った</a></p>

<p><a href="https://mymarkdown-e7d15.firebaseapp.com/">このURL</a> で稼働中です。</p>

<ul>
  <li>Firebase/Nuxt.jsで趣味プロジェクトをリプレースした</li>
</ul>

<p>数年前にheroku・jQuery Mobile・node jsといった構成で作ったモバイルアプリがあったのですが、今度はNuxt.jsを触ってみたかったのでFirebaseでホストするNuxt.jsのSSRアプリとしてリプレースしました。<br />
こちら <a href="https://shikibetsuhyo.yysaki.com">このURL</a> で稼働中です。<br />
<a href="https://qiita.com/yysaki/items/aa699ac02ad1875f9b21">一部Qiita記事</a>に切り出しているのですが、開発に飽きたのでそのうちまとめ記事を書こうかと思ってます。</p>

<ul>
  <li>Rails1000時間メニューに入門</li>
</ul>

<p>FirebaseはNoSQLとして構築が簡単でいいのですが・先程挙げた弱点の克服にweb api、DBを体系立てて学ぶのにはRuby on Railsがちょうどいいと思います。<br />
golangやPHPのLarabelなど選択肢はいくつもありますが、人生初めて触ったLL言語がRubyのため、Rubyに個人的に思い入れがあります。<br />
簡単なRailsアプリを作ったことはありますが業務でやったことがないので、何が不足してるかわからん、みたいな状態です。<br />
そんなところで <a href="https://qiita.com/saboyutaka/items/1a8c40e105e93ac6856a">未経験からRuby on Railsを学んで仕事につなげるまでの1000時間メニュー - Qiita</a> という記事を見かけました。<br />
どこが抜けてるか試すのにちょうどいいので初心者向けすぎてマッチしてないと感じる箇所はスキップしつつ、このコースを走っているのが今ココです。</p>

<p>あとはそうですね、vimの活動として <a href="https://vimconf.org/2018/">Vimconf2018</a> に参加したり、 <a href="https://qiita.com/yysaki/items/fb1cbca8933c6080ebb6">Vim Advent Calendar 2018 その2 に記事を投稿したり</a> しました。<br />
今年は参加記事を書いておらず恐縮ですが、vimのautherであるBram Moolenaar氏のKeynoteが直に聞けたのは最高でした。</p>

<h2 id="新年の抱負">新年の抱負</h2>

<p>さて、新年の抱負としては、以下のようなことをしてみたいと思っています。</p>

<ul>
  <li>1年間で100冊本を読む</li>
</ul>

<p>昨年達成できなかったので再度目標にしたいと思います。</p>

<ul>
  <li>rubykaigiに参加する</li>
</ul>

<p>福岡なので遠いなあと思っていたのですが、会社支援のもと参加できることになりました。<br />
以前参加したrubykaigi 2015は自費+有給使用でしたので福利厚生が増したのを感じます。</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">RubyKaigi申し込んだ<br />会社支援のもと参加できるのありがたい</p>&mdash; sasaki (@yysaki) <a href="https://twitter.com/yysaki/status/1078224873867010048?ref_src=twsrc%5Etfw">2018年12月27日</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<ul>
  <li>メンタルヘルスマネジメント検定を受ける</li>
</ul>

<p>メンタルに自信のない、ちょうどいい資格試験があるのを教わりました。</p>

<p><a href="https://www.mental-health.ne.jp/">メンタルヘルス・マネジメント検定試験,検定,試験,メンタル,大阪商工会議所</a></p>

<p>ひとまずⅢ種 セルフケアコース の公式テキストを取り寄せて読んでいます。<br />
これの資格取得を含め、学習していきたいところです。</p>


  <h1>#Webサービスを作る本 を読んで簡易markdownエディタを作った</h1>
  <p><a href="https://twitter.com/nabettu">@nabetu</a> さんの執筆した <a href="http://www.amazon.co.jp/exec/obidos/ASIN/4844398350/tatsuakiw-22/">Vue.jsとFirebaseで作るミニWebサービス (技術書典シリーズ(NextPublishing))</a> の手順を写経してFirebase上で動く簡単なmarkdownディターのアプリを作成しました。 <a href="https://mymarkdown-e7d15.firebaseapp.com/">こちらのURL</a> で実際に稼働中です。</p>

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr"><a href="https://twitter.com/hashtag/Web%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E4%BD%9C%E3%82%8B%E6%9C%AC?src=hash&amp;ref_src=twsrc%5Etfw">#Webサービスを作る本</a> 1周目終了。<br />UIの手入れすっ飛ばしたので週末vuetifyで遊んで設定してから強くてニューゲーム行きます。<br />DBは本書使用のRealtime DatabaseでなくCloud Firestoreを採用したので、設定の違いなどをブログ記事に起こすかも。<a href="https://t.co/l903YvwWbL">https://t.co/l903YvwWbL</a></p>&mdash; sasaki (@yysaki) <a href="https://twitter.com/yysaki/status/1034464372041515008?ref_src=twsrc%5Etfw">August 28, 2018</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>このtweetからもある程度作業を進め、自分の中で修正の区切りがついたので記事をまとめます。<br />
なお、作成したwebサービスのソースコードは<a href="https://github.com/yysaki/mymarkdown">github</a> に公開しています。</p>

<!-- more -->

<h2 id="前置き">前置き</h2>

<p>本書はタイトルの通り, Vue.jsとFirebaseを使ってSPAなWebサービスを実際に作ってみるために必要なことがまとめられた本です。<br />
私は普段の業務では双方触らないものの、強い興味があって手っ取り早く学習してみたかったためkindle版を購入しました。</p>

<p>Firebaseは別の趣味プロジェクトでホスティングサービスであるところのFirebase Hosting、およびexpress js を走らせるためのFirebase Cloud Functionを使ったことはあったのですが、NoSQLのRealtime Databaseや Cloud Firestoreは使ったことがありませんでした。<br />
Vue.jsについては全くの新規です。前知識としてはReactに並ぶ仮想DOMを使ったフロントエンドフレームワーク、というような大雑把な理解しかありませんでした。<br />
日本人ソフトウェアエンジニア界隈で流行が始まっている気配を感じていたので、これを機会に学ぼうというところです。</p>

<h2 id="1周目">1周目</h2>

<p>本編はVue.jsおよびFirebase Realtime Databaseを使って動くmarkdownエディタを作成していきます。文章を読んでコードを写経すればほぼ問題なく進められました。<br />
僕が見た時点ではファイルパスなどの誤植がいくつかありますが、 <a href="https://github.com/nabettu/mymarkdown">著者のサポートリポジトリ</a> にまとめられているのでつまづくことはありませんでした。<br />
また、ロゴの簡単な作り方や利用規約・プライバシーポリシーの書き方が説明されており、大事な部分だなと勉強になりました。<br />
結局ロゴの作成はサボってしまったのですが、次自分のサービスを作るときにはすぐ作成できる安心感が手に入りました。</p>

<h2 id="firebase">Firebase</h2>

<p>本編ではRealtime Databaseを使ったやり方が紹介されてますが、どちらかというと現在β版であるFirestoreが使って見たかったので、あえて後者を試しました。<br />
これには多少苦戦して、最終的に以下の記述をして対処しました。<br />
<a href="https://github.com/yysaki/mymarkdown/commit/5d89a7c7cea411c76ed6ca960c42f9a780dfc8c3">githubでいうとこの辺です。</a></p>

<p>Firestore ルール:</p>
<div class="language-txt highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre>service cloud.firestore {
  match /databases/{database}/documents {
    match /memos/{userId} {
      allow read, write: if request.auth.uid == userId;    
    }
  }
}
</pre></div>
</div>
</div>

<p>created:</p>
<div class="language-javascript highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#06B;font-weight:bold">created</span>: <span style="color:#080;font-weight:bold">function</span>() {
  <span style="color:#080;font-weight:bold">var</span> self = <span style="color:#950">this</span>;
  firebase
    .firestore()
    .collection(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">memos</span><span style="color:#710">'</span></span>)
    .doc(<span style="color:#950">this</span>.user.uid)
    .get()
    .then(<span style="color:#080;font-weight:bold">function</span>(doc) {
      <span style="color:#080;font-weight:bold">if</span> (doc.exists) {
        self.memos = doc.data().val;
      }
    });
},
</pre></div>
</div>
</div>

<p>saveMemos:</p>
<div class="language-javascript highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span style="color:#06B;font-weight:bold">saveMemos</span>: <span style="color:#080;font-weight:bold">function</span>() {
  firebase
    .firestore()
    .collection(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">memos</span><span style="color:#710">'</span></span>)
    .doc(<span style="color:#950">this</span>.user.uid)
    .set({<span style="color:#606">val</span>: <span style="color:#950">this</span>.memos});
},
</pre></div>
</div>
</div>

<p>今イチからやるのであれば <a href="https://github.com/nabettu/firestore-manual">Firestore 移行マニュアル</a> が公開してくださっているのでそちらを参考にするとよいと思います。</p>

<h2 id="強くてニューゲームちょい足しポイント">強くてニューゲーム・ちょい足しポイント</h2>

<p>本書はシンプルなmarkdownエディタを作る手順が載っているんですが、追加お題の随所に散りばめられた「ちょい足しポイント」や巻末の初心者や中級者向けに出題された「強くてニューゲーム」があります。<br />
私は全体の半分程度手を出したのですが、それぞれやりごたえがありました。<br />
実際にやったうちいくつか例をあげると、</p>

<p>ちょい足しポイント:</p>
<ul>
  <li>デプロイにCIを使う。</li>
  <li>状態管理にVuexを使用する。</li>
  <li>Vuetifyを使ってマテリアルデザインのサイトにする</li>
</ul>

<p>強くてニューゲーム:</p>
<ul>
  <li>ナビゲーションバーの追加</li>
  <li>マークダウンでチェックボックスを表示できるようにする</li>
  <li>ログイン時に表示までLoadingを入れる</li>
  <li>セーブ中はセーブボタンがローディングする(ローディング中は押せない)</li>
</ul>

<p>などです。</p>

<p>その際Vue.jsやライブラリであるVuex, Vue Router, Vuetify.jsの公式ドキュメントを読んだのですが、ドキュメントが充実しているのに驚きました。<br />
ほとんどが日本語訳されているし、サンプルコードにcodepenへのリンクがあり実際にスクラッチして試せるのです。<br />
特にCSSのflexboxに不慣れだったのですが、Vuetify.jsの <a href="https://vuetifyjs.com/en/layout/grid">Grid system</a> を何度も読み書きしてなんとかまともに動くものが作れるまでになりました。</p>

<p>また、 <a href="https://github.com/nabettu/mymarkdown/tree/feature/add-design">著者のリポジトリ</a> に強くてニューゲームのサンプルがあったので何度も参考になりました。</p>

<h2 id="感想">感想</h2>

<p>この本を読んで写経することで手軽にwebサービスが作れる成功体験が得られました。<br />
特にFirebaseは無料のプランで満足できるものが始められるので初動が気楽です。<br />
また、社内slackに公開したURLを貼って見せるとフィードバックが得られ、typoを次々見つけてもらって面白かったということもありました。</p>

<p>以上です。</p>



        </main>
      </div>

      <div class="large-4 medium-5 columns">
        <aside class="sidebar">
          <div class="about">
            <h1>About Me</h1>
            <ul class="side-nav">
              <li role="menuitem"><a href="https://twitter.com/yysaki">@yysaki on Twitter</a></li>
              <li role="menuitem"><a href="https://github.com/yysaki">@yysaki on Github</a></li>
            </ul>
          </div>

          

<div class="recent">
  <h1>Recent Posts</h1>
  <ul class="side-nav">
    
      <li role="menuitem"><a href="/blog/2020/06/07/terraform-hasura/">Terraform RegistryのModuleを使ってHasuraを立てる</a></li>
    
      <li role="menuitem"><a href="/blog/2020/04/29/react-tic-tac-toe/">Reactのチュートリアルで三目並べ</a></li>
    
      <li role="menuitem"><a href="/blog/2019/04/14/techbookfest-6/">技術書典6に参加した</a></li>
    
      <li role="menuitem"><a href="/blog/2019/01/02/happy-new-year/">昨年の振り返りと新年の抱負</a></li>
    
      <li role="menuitem"><a href="/blog/2018/09/30/vue-firebase-tutorial/">#Webサービスを作る本 を読んで簡易markdownエディタを作った</a></li>
    
  </ul>
</div>


          <div class="twitter">
            <h1>Timeline</h1>
            <a class="twitter-timeline" href="https://twitter.com/yysaki" data-widget-id="435964636265844738">@yysakiさんのツイート</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          </div>
        </aside>
      </div>
    </div>

    <script src="/js/jquery.js"></script>
    <script src="/js/foundation.js"></script>
    <script src="/js/app.js"></script>
  </body>
</html>
